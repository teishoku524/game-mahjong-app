<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ€„ï¸ ã‚²ãƒ¼ãƒ å‹Ÿé›†</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .thread-post {
      border-left: 3px solid #9333EA;
      background: rgba(255,255,255,0.05);
    }
    .anchor-link {
      color: #22d3ee;
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc, query, orderBy, arrayUnion } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

    const firebaseConfig = {
      apiKey: "AIzaSyCCPWKn60sOVXBxTjUaoaiV_ob6u98K11U",
      authDomain: "game-mahjong-app.firebaseapp.com",
      projectId: "game-mahjong-app",
      storageBucket: "game-mahjong-app.firebasestorage.app",
      messagingSenderId: "374194287250",
      appId: "1:374194287250:web:feb1ca77f53ee1a6786c4b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function App() {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [passwordInput, setPasswordInput] = useState('');
      const [currentTab, setCurrentTab] = useState('recruit');
      const [events, setEvents] = useState([]);
      const [threads, setThreads] = useState([]);
      const [currentThread, setCurrentThread] = useState(null);
      const [showCreateForm, setShowCreateForm] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [showThreadForm, setShowThreadForm] = useState(false);
      
      // å‹Ÿé›†ãƒ•ã‚©ãƒ¼ãƒ 
      const [newEventTitle, setNewEventTitle] = useState('');
      const [newEventTime, setNewEventTime] = useState('');
      const [newEventDeadline, setNewEventDeadline] = useState('');
      const [newEventMinPlayers, setNewEventMinPlayers] = useState(3);
      const [newEventNote, setNewEventNote] = useState('');
      
      // ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ•ã‚©ãƒ¼ãƒ 
      const [newThreadTitle, setNewThreadTitle] = useState('');
      const [newThreadBody, setNewThreadBody] = useState('');
      const [replyText, setReplyText] = useState('');
      
      const [copiedId, setCopiedId] = useState(null);
      const [webhookUrl] = useState('https://discord.com/api/webhooks/1449053407087427615/ZPXACZFVww4_PVWvO3ei8bkDeH-zGnPbhr6oJ57KF-xgPe7QCbgg6VQyUvj_cSL8y0we');
      const [commentText, setCommentText] = useState({});
      const [showComments, setShowComments] = useState({});

      useEffect(() => {
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãƒã‚§ãƒƒã‚¯
        const savedAuth = localStorage.getItem('authenticated');
        if (savedAuth === 'true') {
          setIsAuthenticated(true);
        }
        
        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹
        if (isAuthenticated) {
          loadData();
        }
      }, [isAuthenticated]);

      const loadData = () => {
      const loadData = () => {
        
        // å‹Ÿé›†ãƒ‡ãƒ¼ã‚¿
        const qEvents = query(collection(db, 'events'), orderBy('createdAt', 'desc'));
        const unsubEvents = onSnapshot(qEvents, (snapshot) => {
          const eventsList = [];
          snapshot.forEach((doc) => {
            const data = doc.data();
            if (!data.deleted) {
              eventsList.push({ id: doc.id, ...data });
            }
          });
          setEvents(eventsList);
        });

        // ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ‡ãƒ¼ã‚¿
        const qThreads = query(collection(db, 'threads'), orderBy('updatedAt', 'desc'));
        const unsubThreads = onSnapshot(qThreads, (snapshot) => {
          const threadsList = [];
          snapshot.forEach((doc) => {
            const data = doc.data();
            if (!data.deleted) {
              threadsList.push({ id: doc.id, ...data });
            }
          });
          setThreads(threadsList);
        });

        return () => {
          unsubEvents();
          unsubThreads();
        };
      };

      useEffect(() => {
        const checkExpired = setInterval(async () => {
          const now = new Date();
          events.forEach(async (event) => {
            if (event.deadline && new Date(event.deadline) < now) {
              try {
                await deleteDoc(doc(db, 'events', event.id));
              } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
              }
            }
          });
        }, 60000);

        return () => clearInterval(checkExpired);
      }, [events]);

      const loadWebhookUrl = () => {
        // Webhook URLã¯å›ºå®šãªã®ã§ä½•ã‚‚ã—ãªã„
      };

      const saveWebhookUrl = () => {
        // Webhook URLã¯å›ºå®šãªã®ã§ä½•ã‚‚ã—ãªã„
        setShowSettings(false);
      };

      const handleLogin = () => {
        if (passwordInput === '4159') {
          setIsAuthenticated(true);
          localStorage.setItem('authenticated', 'true');
          setPasswordInput('');
        } else {
          alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
          setPasswordInput('');
        }
      };

      const handleLogout = () => {
        if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
          setIsAuthenticated(false);
          localStorage.removeItem('authenticated');
        }
      };

      const sendDiscordNotification = async (event) => {
        if (!webhookUrl) return;

        const eventUrl = `${window.location.href.split('#')[0]}#${event.id}`;
        
        let description = `â° ${event.time}\nğŸ‘¥ å¿…è¦äººæ•°: ${event.minPlayers}äºº`;
        if (event.deadline) {
          const deadline = new Date(event.deadline);
          description += `\nâ³ ç· åˆ‡: ${deadline.toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })}`;
        }
        if (event.note) {
          description += `\nğŸ“ ${event.note}`;
        }

        const embed = {
          title: `ğŸ® ${event.title}ã½`,
          description: description,
          color: 0x9333EA,
          fields: [{ name: "å‚åŠ æ–¹æ³•", value: `[ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯](${eventUrl})`, inline: false }],
          timestamp: new Date().toISOString()
        };

        try {
          await fetch(webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: "@everyone", embeds: [embed] })
          });
        } catch (error) {
          console.error('Discordé€šçŸ¥é€ä¿¡å¤±æ•—:', error);
        }
      };

      const sendCommentNotification = async (event, comment) => {
        if (!webhookUrl) return;
        try {
          await fetch(webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: `ğŸ’¬ **${event.title}** ã«ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã—ãŸï¼\n> ${comment}` })
          });
        } catch (error) {
          console.error('ã‚³ãƒ¡ãƒ³ãƒˆé€šçŸ¥ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      const createEvent = async () => {
        if (!newEventTitle.trim()) return;

        const newEvent = {
          title: newEventTitle,
          time: newEventTime || 'ä»Šæ—¥',
          deadline: newEventDeadline || null,
          minPlayers: newEventMinPlayers,
          note: newEventNote,
          participants: [],
          comments: [],
          createdAt: Date.now()
        };

        try {
          const docRef = await addDoc(collection(db, 'events'), newEvent);
          setNewEventTitle('');
          setNewEventTime('');
          setNewEventDeadline('');
          setNewEventMinPlayers(3);
          setNewEventNote('');
          setShowCreateForm(false);
          await sendDiscordNotification({ id: docRef.id, ...newEvent });
          alert('å‹Ÿé›†ã‚’ä½œæˆã—ã¾ã—ãŸï¼ğŸ‰');
        } catch (error) {
          console.error('ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
          alert('å‹Ÿé›†ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };

      const createThread = async () => {
        if (!newThreadTitle.trim() || !newThreadBody.trim()) return;

        const newThread = {
          title: newThreadTitle,
          posts: [{ id: 1, text: newThreadBody, timestamp: Date.now() }],
          createdAt: Date.now(),
          updatedAt: Date.now()
        };

        try {
          await addDoc(collection(db, 'threads'), newThread);
          setNewThreadTitle('');
          setNewThreadBody('');
          setShowThreadForm(false);
          alert('ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸï¼');
        } catch (error) {
          console.error('ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
          alert('ã‚¹ãƒ¬ãƒƒãƒ‰ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };

      const addReply = async () => {
        if (!replyText.trim() || !currentThread) return;

        const thread = threads.find(t => t.id === currentThread.id);
        if (!thread) return;

        const posts = thread.posts || [];
        const newPost = {
          id: posts.length + 1,
          text: replyText,
          timestamp: Date.now()
        };

        try {
          await updateDoc(doc(db, 'threads', currentThread.id), {
            posts: arrayUnion(newPost),
            updatedAt: Date.now()
          });
          setReplyText('');
        } catch (error) {
          console.error('ãƒ¬ã‚¹æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:', error);
          alert('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };

      const deleteEvent = async (eventId) => {
        if (!confirm('ã“ã®å‹Ÿé›†ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        try {
          await updateDoc(doc(db, 'events', eventId), {
            deleted: true,
            deletedAt: Date.now()
          });
        } catch (error) {
          console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      const deleteThread = async (threadId) => {
        if (!confirm('ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        try {
          await updateDoc(doc(db, 'threads', threadId), {
            deleted: true,
            deletedAt: Date.now()
          });
          setCurrentThread(null);
        } catch (error) {
          console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      const joinEvent = async (eventId) => {
        const userId = getUserId();
        const event = events.find(e => e.id === eventId);
        if (!event) return;

        const wasEnough = event.participants.length >= event.minPlayers;
        let newParticipants;

        if (event.participants.includes(userId)) {
          newParticipants = event.participants.filter(id => id !== userId);
        } else {
          newParticipants = [...event.participants, userId];
        }

        const isNowEnough = newParticipants.length >= event.minPlayers;

        try {
          await updateDoc(doc(db, 'events', eventId), { participants: newParticipants });

          if (!wasEnough && isNowEnough && webhookUrl) {
            await fetch(webhookUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ content: `ğŸ‰ **${event.title}** ã®é–‹å‚¬ãŒæ±ºå®šã—ã¾ã—ãŸï¼\nğŸ‘¥ ${newParticipants.length}äººé›†ã¾ã‚Šã¾ã—ãŸï¼` })
            });
          }
        } catch (error) {
          console.error('å‚åŠ ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      const addComment = async (eventId) => {
        const text = commentText[eventId]?.trim();
        if (!text) return;

        const event = events.find(e => e.id === eventId);
        if (!event) return;

        const newComment = { text: text, timestamp: Date.now() };

        try {
          await updateDoc(doc(db, 'events', eventId), { comments: arrayUnion(newComment) });
          setCommentText({ ...commentText, [eventId]: '' });
          await sendCommentNotification(event, text);
        } catch (error) {
          console.error('ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      const getUserId = () => {
        let userId = localStorage.getItem('userId');
        if (!userId) {
          userId = `user_${Math.random().toString(36).substr(2, 9)}`;
          localStorage.setItem('userId', userId);
        }
        return userId;
      };

      const copyEventUrl = (eventId) => {
        const url = `${window.location.href.split('#')[0]}#${eventId}`;
        navigator.clipboard.writeText(url);
        setCopiedId(eventId);
        setTimeout(() => setCopiedId(null), 2000);
      };

      const isUserJoined = (event) => {
        return event.participants.includes(getUserId());
      };

      const isExpired = (event) => {
        if (!event.deadline) return false;
        return new Date(event.deadline) < new Date();
      };

      const formatTimestamp = (timestamp) => {
        const date = new Date(timestamp);
        return date.toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
      };

      const renderTextWithAnchors = (text) => {
        const parts = text.split(/(>>\\d+)/g);
        return parts.map((part, i) => {
          if (part.match(/>>\\d+/)) {
            return React.createElement('span', { key: i, className: 'anchor-link' }, part);
          }
          return part;
        });
      };

      // å‹Ÿé›†ã‚¿ãƒ–
      const renderRecruitTab = () => {
        return React.createElement('div', null,
          !showCreateForm ? React.createElement('button', {
            onClick: () => setShowCreateForm(true),
            className: 'w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg mb-6'
          }, '+ æ–°ã—ãå‹Ÿé›†ã™ã‚‹') : React.createElement('div', { className: 'bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6 border border-white/20' },
            React.createElement('h2', { className: 'text-white font-bold text-xl mb-4' }, 'æ–°è¦å‹Ÿé›†'),
            React.createElement('input', {
              type: 'text',
              placeholder: 'ã‚²ãƒ¼ãƒ ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹ï¼šAPEXï¼‰',
              value: newEventTitle,
              onChange: (e) => setNewEventTitle(e.target.value),
              className: 'w-full bg-white/20 text-white placeholder-purple-200 border border-white/30 rounded-lg px-4 py-3 mb-3'
            }),
            React.createElement('input', {
              type: 'text',
              placeholder: 'é–‹å§‹æ™‚é–“ï¼ˆä¾‹ï¼š21:00ã€œï¼‰',
              value: newEventTime,
              onChange: (e) => setNewEventTime(e.target.value),
              className: 'w-full bg-white/20 text-white placeholder-purple-200 border border-white/30 rounded-lg px-4 py-3 mb-3'
            }),
            React.createElement('div', { className: 'mb-3' },
              React.createElement('label', { className: 'text-purple-200 text-sm mb-2 block' }, 'å‹Ÿé›†ç· åˆ‡æ™‚é–“ï¼ˆä»»æ„ï¼‰'),
              React.createElement('input', {
                type: 'datetime-local',
                value: newEventDeadline,
                onChange: (e) => setNewEventDeadline(e.target.value),
                className: 'w-full bg-white/20 text-white border border-white/30 rounded-lg px-4 py-3'
              })
            ),
            React.createElement('div', { className: 'mb-3' },
              React.createElement('label', { className: 'text-purple-200 text-sm mb-2 block' }, 'å¿…è¦äººæ•°'),
              React.createElement('input', {
                type: 'number',
                min: '2',
                max: '10',
                value: newEventMinPlayers,
                onChange: (e) => setNewEventMinPlayers(parseInt(e.target.value)),
                className: 'w-full bg-white/20 text-white border border-white/30 rounded-lg px-4 py-3'
              })
            ),
            React.createElement('textarea', {
              placeholder: 'è£œè¶³æƒ…å ±ï¼ˆä»»æ„ï¼‰',
              value: newEventNote,
              onChange: (e) => setNewEventNote(e.target.value),
              rows: 3,
              className: 'w-full bg-white/20 text-white placeholder-purple-200 border border-white/30 rounded-lg px-4 py-3 mb-4'
            }),
            React.createElement('div', { className: 'flex gap-3' },
              React.createElement('button', {
                onClick: createEvent,
                className: 'flex-1 bg-gradient-to-r from-green-400 to-blue-500 text-white py-3 rounded-lg font-bold'
              }, 'ä½œæˆ'),
              React.createElement('button', {
                onClick: () => setShowCreateForm(false),
                className: 'flex-1 bg-white/20 text-white py-3 rounded-lg font-bold'
              }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
            )
          ),

          React.createElement('div', { className: 'space-y-4' },
            events.length === 0 ? React.createElement('div', { className: 'text-center py-12 text-purple-200' },
              React.createElement('p', null, 'ã¾ã å‹Ÿé›†ãŒã‚ã‚Šã¾ã›ã‚“')
            ) : events.map(event => {
              const isEnough = event.participants.length >= event.minPlayers;
              const userJoined = isUserJoined(event);
              const expired = isExpired(event);
              const comments = event.comments || [];

              return React.createElement('div', {
                key: event.id,
                className: `bg-white/10 backdrop-blur-lg rounded-xl p-6 border-2 ${isEnough ? 'border-green-400' : expired ? 'border-red-400' : 'border-white/20'}`
              },
                React.createElement('div', { className: 'flex justify-between items-start mb-4' },
                  React.createElement('div', { className: 'flex-1' },
                    React.createElement('h3', { className: 'text-white font-bold text-xl mb-1' }, event.title),
                    React.createElement('p', { className: 'text-purple-200 text-sm' }, 'â° ' + event.time),
                    event.deadline && React.createElement('p', { className: `text-sm ${expired ? 'text-red-400' : 'text-purple-300'}` },
                      'â³ ç· åˆ‡: ' + new Date(event.deadline).toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })
                    ),
                    event.note && React.createElement('p', { className: 'text-purple-200 text-sm mt-2' }, 'ğŸ“ ' + event.note)
                  ),
                  React.createElement('div', { className: 'flex gap-2' },
                    React.createElement('button', {
                      onClick: () => copyEventUrl(event.id),
                      className: 'bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg'
                    }, copiedId === event.id ? 'âœ“' : 'ğŸ“‹'),
                    React.createElement('button', {
                      onClick: () => deleteEvent(event.id),
                      className: 'bg-red-500/20 hover:bg-red-500/30 text-red-200 p-2 rounded-lg'
                    }, 'ğŸ—‘ï¸')
                  )
                ),
                React.createElement('div', { className: 'mb-4' },
                  React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
                    React.createElement('span', { className: 'text-white font-bold' }, `${event.participants.length} / ${event.minPlayers}äºº`),
                    isEnough && React.createElement('span', { className: 'bg-green-500 text-white text-xs px-2 py-1 rounded-full font-bold' }, 'é–‹å‚¬æ±ºå®šï¼'),
                    expired && React.createElement('span', { className: 'bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold' }, 'å‹Ÿé›†çµ‚äº†')
                  ),
                  React.createElement('div', { className: 'flex gap-1 flex-wrap' },
                    event.participants.map((_, i) => React.createElement('span', { key: i, className: 'text-3xl' }, 'ğŸ€„ï¸'))
                  )
                ),
                !expired && React.createElement('button', {
                  onClick: () => joinEvent(event.id),
                  className: `w-full py-3 rounded-lg font-bold mb-3 ${userJoined ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white'}`
                }, userJoined ? 'ğŸ€„ï¸ å‚åŠ å–ã‚Šæ¶ˆã—' : 'ğŸ€„ï¸ å‚åŠ ã™ã‚‹'),

                React.createElement('div', { className: 'border-t border-white/20 pt-3 mt-3' },
                  React.createElement('button', {
                    onClick: () => setShowComments({ ...showComments, [event.id]: !showComments[event.id] }),
                    className: 'text-purple-200 text-sm mb-3 hover:text-white'
                  }, `ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ (${comments.length})`),
                  
                  showComments[event.id] && React.createElement('div', null,
                    comments.length > 0 && React.createElement('div', { className: 'space-y-2 mb-3 max-h-40 overflow-y-auto' },
                      comments.map((comment, i) => 
                        React.createElement('div', { key: i, className: 'bg-white/5 rounded-lg p-2' },
                          React.createElement('p', { className: 'text-white text-sm' }, comment.text),
                          React.createElement('p', { className: 'text-purple-300 text-xs mt-1' }, formatTimestamp(comment.timestamp))
                        )
                      )
                    ),
                    React.createElement('div', { className: 'flex gap-2' },
                      React.createElement('input', {
                        type: 'text',
                        placeholder: 'ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›...',
                        value: commentText[event.id] || '',
                        onChange: (e) => setCommentText({ ...commentText, [event.id]: e.target.value }),
                        onKeyPress: (e) => e.key === 'Enter' && addComment(event.id),
                        className: 'flex-1 bg-white/20 text-white placeholder-purple-300 border border-white/30 rounded-lg px-3 py-2 text-sm'
                      }),
                      React.createElement('button', {
                        onClick: () => addComment(event.id),
                        className: 'bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-bold'
                      }, 'é€ä¿¡')
                    )
                  )
                )
              );
            })
          )
        );
      };

      // æ²ç¤ºæ¿ã‚¿ãƒ–
      const renderBoardTab = () => {
        if (currentThread) {
          // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’æ›´æ–°
          const thread = threads.find(t => t.id === currentThread.id);
          const posts = thread ? (thread.posts || []) : (currentThread.posts || []);
          
          return React.createElement('div', null,
            React.createElement('button', {
              onClick: () => setCurrentThread(null),
              className: 'text-purple-200 mb-4 hover:text-white'
            }, 'â† ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§ã«æˆ»ã‚‹'),
            React.createElement('div', { className: 'bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-4 border border-white/20' },
              React.createElement('div', { className: 'flex justify-between items-start mb-4' },
                React.createElement('h2', { className: 'text-white font-bold text-2xl' }, currentThread.title),
                React.createElement('button', {
                  onClick: () => deleteThread(currentThread.id),
                  className: 'bg-red-500/20 hover:bg-red-500/30 text-red-200 p-2 rounded-lg text-sm'
                }, 'å‰Šé™¤')
              ),
              React.createElement('div', { className: 'space-y-3 max-h-96 overflow-y-auto mb-4' },
                posts.map(post => 
                  React.createElement('div', { key: post.id, className: 'thread-post p-3 rounded' },
                    React.createElement('div', { className: 'flex gap-2 mb-1' },
                      React.createElement('span', { className: 'text-purple-300 font-bold' }, post.id),
                      React.createElement('span', { className: 'text-purple-300 text-sm' }, formatTimestamp(post.timestamp))
                    ),
                    React.createElement('p', { className: 'text-white whitespace-pre-wrap' }, renderTextWithAnchors(post.text))
                  )
                )
              ),
              React.createElement('div', null,
                React.createElement('textarea', {
                  placeholder: 'ãƒ¬ã‚¹ã‚’æ›¸ã...',
                  value: replyText,
                  onChange: (e) => setReplyText(e.target.value),
                  rows: 3,
                  className: 'w-full bg-white/20 text-white placeholder-purple-300 border border-white/30 rounded-lg px-4 py-3 mb-3'
                }),
                React.createElement('button', {
                  onClick: addReply,
                  className: 'bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-bold'
                }, 'æŠ•ç¨¿')
              )
            )
          );
        }

        return React.createElement('div', null,
          !showThreadForm ? React.createElement('button', {
            onClick: () => setShowThreadForm(true),
            className: 'w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg mb-6'
          }, '+ æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç«‹ã¦ã‚‹') : React.createElement('div', { className: 'bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6 border border-white/20' },
            React.createElement('h2', { className: 'text-white font-bold text-xl mb-4' }, 'æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰'),
            React.createElement('input', {
              type: 'text',
              placeholder: 'ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«',
              value: newThreadTitle,
              onChange: (e) => setNewThreadTitle(e.target.value),
              className: 'w-full bg-white/20 text-white placeholder-purple-200 border border-white/30 rounded-lg px-4 py-3 mb-3'
            }),
            React.createElement('textarea', {
              placeholder: 'æœ¬æ–‡',
              value: newThreadBody,
              onChange: (e) => setNewThreadBody(e.target.value),
              rows: 5,
              className: 'w-full bg-white/20 text-white placeholder-purple-200 border border-white/30 rounded-lg px-4 py-3 mb-4'
            }),
            React.createElement('div', { className: 'flex gap-3' },
              React.createElement('button', {
                onClick: createThread,
                className: 'flex-1 bg-gradient-to-r from-green-400 to-blue-500 text-white py-3 rounded-lg font-bold'
              }, 'ä½œæˆ'),
              React.createElement('button', {
                onClick: () => setShowThreadForm(false),
                className: 'flex-1 bg-white/20 text-white py-3 rounded-lg font-bold'
              }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
            )
          ),

          React.createElement('div', { className: 'space-y-3' },
            threads.length === 0 ? React.createElement('div', { className: 'text-center py-12 text-purple-200' },
              React.createElement('p', null, 'ã¾ã ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“')
            ) : threads.map(thread => {
              const postCount = (thread.posts || []).length;
              return React.createElement('div', {
                key: thread.id,
                onClick: () => setCurrentThread(thread),
                className: 'bg-white/10 backdrop-blur-lg rounded-lg p-4 border border-white/20 cursor-pointer hover:bg-white/15 transition'
              },
                React.createElement('h3', { className: 'text-white font-bold text-lg mb-2' }, thread.title),
                React.createElement('div', { className: 'flex gap-4 text-sm text-purple-300' },
                  React.createElement('span', null, `${postCount}ãƒ¬ã‚¹`),
                  React.createElement('span', null, formatTimestamp(thread.updatedAt))
                )
              );
            })
          )
        );
      };

      return React.createElement('div', { className: 'min-h-screen p-4' },
        !isAuthenticated ? React.createElement('div', { className: 'min-h-screen flex items-center justify-center' },
          React.createElement('div', { className: 'bg-white/10 backdrop-blur-lg rounded-xl p-8 border border-white/20 max-w-md w-full' },
            React.createElement('div', { className: 'text-center mb-6' },
              React.createElement('h1', { className: 'text-4xl font-bold text-white mb-2' }, 'ğŸ€„ï¸ ã‚²ãƒ¼ãƒ å‹Ÿé›†'),
              React.createElement('p', { className: 'text-purple-200' }, 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')
            ),
            React.createElement('input', {
              type: 'password',
              placeholder: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰',
              value: passwordInput,
              onChange: (e) => setPasswordInput(e.target.value),
              onKeyPress: (e) => e.key === 'Enter' && handleLogin(),
              className: 'w-full bg-white/20 text-white placeholder-purple-300 border border-white/30 rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-purple-400 text-center text-2xl tracking-widest'
            }),
            React.createElement('button', {
              onClick: handleLogin,
              className: 'w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-bold text-lg hover:shadow-lg transition'
            }, 'ãƒ­ã‚°ã‚¤ãƒ³')
          )
        ) : React.createElement('div', { className: 'max-w-2xl mx-auto' },
          React.createElement('div', { className: 'text-center mb-8 pt-6' },
            React.createElement('div', { className: 'flex items-center justify-center gap-3 mb-2' },
              React.createElement('h1', { className: 'text-4xl font-bold text-white' }, 'ğŸ€„ï¸ ã‚²ãƒ¼ãƒ å‹Ÿé›†'),
              React.createElement('button', {
                onClick: handleLogout,
                className: 'bg-red-500/20 hover:bg-red-500/30 text-red-200 p-2 rounded-lg transition-all',
                title: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ'
              }, 'ğŸšª')
            ),
            React.createElement('p', { className: 'text-purple-200' }, 'åŒ¿åã§å‚åŠ è¡¨æ˜ + Discordé€šçŸ¥')
          ),

          React.createElement('div', { className: 'flex gap-2 mb-6' },
            React.createElement('button', {
              onClick: () => setCurrentTab('recruit'),
              className: `flex-1 py-3 rounded-lg font-bold transition ${currentTab === 'recruit' ? 'bg-purple-500 text-white' : 'bg-white/10 text-purple-200'}`
            }, 'ğŸ® å‹Ÿé›†'),
            React.createElement('button', {
              onClick: () => setCurrentTab('board'),
              className: `flex-1 py-3 rounded-lg font-bold transition ${currentTab === 'board' ? 'bg-purple-500 text-white' : 'bg-white/10 text-purple-200'}`
            }, 'ğŸ“‹ æ²ç¤ºæ¿')
          ),

          currentTab === 'recruit' ? renderRecruitTab() : renderBoardTab()
        )
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));
  </script>
</body>
</html>